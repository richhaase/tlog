{"id":"tl-39bc92fb","ts":"2026-01-17T00:44:01.109719Z","type":"status","status":"done","resolution":"wontfix","notes":"Accidentally added task"}
{"id":"975f0525","ts":"2026-01-17T00:44:56.87059Z","type":"create","title":"Add tlog delete command to add a tombstone record for tasks.  On compactions these records will be deleted, and before compaction records that are deleted will not be shown in any tlog output","status":"open"}
{"id":"tl-f70e3d0c","ts":"2026-01-17T00:48:07.166078Z","type":"status","status":"in_progress","notes":"Compaction means taking previous daily files and reducing their logs into single line representations of current state"}
{"id":"tl-f70e3d0c","ts":"2026-01-17T00:49:12.859111Z","type":"status","status":"done","resolution":"completed","notes":"Researched codebase. Compaction strategy: load events from files older than today, compute state, generate single create event per task with final state, write to compacted file, delete old files. Key files: storage.go (add ListEventFiles, DeleteEventFile), commands.go (add Compact), main.go (add compactCmd)."}
{"id":"db6c9d0d","ts":"2026-01-17T00:56:54.408991Z","type":"create","title":"Fix ComputeState to handle Status and Resolution on EventCreate","status":"open","description":"EventCreate in state.go:16-27 hardcodes Status to StatusOpen and ignores Resolution. For compaction to work, must use event.Status if set (default to StatusOpen) and copy event.Resolution to task."}
{"id":"94fb6431","ts":"2026-01-17T00:57:00.639976Z","type":"create","title":"Add tlog compact command","status":"open","deps":["db6c9d0d"],"description":"Implement compact command: load events from files older than today, compute state, emit one create event per task with full current state, write compacted file, delete originals."}
{"id":"94fb6431","ts":"2026-01-17T00:59:43.702876Z","type":"dep","dep":"975f0525","action":"add"}
{"id":"db6c9d0d","ts":"2026-01-17T01:00:18.555815Z","type":"status","status":"in_progress"}
{"id":"db6c9d0d","ts":"2026-01-17T01:03:34.584289Z","type":"status","status":"done","resolution":"completed","notes":"Fixed state.go:16-24 to use event.Status if set (default StatusOpen) and copy event.Resolution to task"}
{"id":"975f0525","ts":"2026-01-17T01:05:57.064377Z","type":"status","status":"in_progress"}
{"id":"7139545f","ts":"2026-01-17T01:18:12.800134Z","type":"create","title":"Test task for deletion","status":"open"}
{"id":"7139545f","ts":"2026-01-17T01:20:02.238775Z","type":"delete","notes":"Testing delete command"}
{"id":"975f0525","ts":"2026-01-17T01:21:40.000592Z","type":"status","status":"done","resolution":"completed","notes":"Implemented delete command: added EventDelete type, Deleted field on Task, ComputeState handling, filtered deleted tasks from all output (list/ready/show/graph/labels/ResolveID), added CmdDelete and deleteCmd"}
{"id":"94fb6431","ts":"2026-01-17T01:45:52.242498Z","type":"status","status":"done","resolution":"completed","notes":"Implemented compact command: writes to compacted.jsonl, removes old dated files, preserves today's file, honors tombstones"}
{"id":"d5adf66a","ts":"2026-01-17T01:56:07.180248Z","type":"create","title":"Enhance tlog prime with richer context and auto-generated CLI reference","status":"open","description":"Improve prime output while staying under 1200 tokens:\n\n1. Auto-generated compact CLI reference\n   - Walk rootCmd.Commands() to build command list\n   - Show each command with its flags in brackets\n   - Group by purpose (lifecycle, query, metadata, etc.)\n   - Format: 'cmd \u003cargs\u003e [--flag1 --flag2]'\n\n2. Richer task context\n   - Summary line: X open, Y in-progress, Z blocked\n   - In-progress section (prevents duplicate work)  \n   - Ready tasks with priority indicators\n   - Blocked tasks showing what they wait on\n   - Recent completions (last 2-3 for context)\n\nKeep existing workflow section. Test token count stays under 1200."}
{"id":"d5adf66a","ts":"2026-01-17T02:00:19.163983Z","type":"status","status":"in_progress"}
{"id":"d5adf66a","ts":"2026-01-17T02:06:24.821266Z","type":"status","status":"done","resolution":"completed","notes":"Implemented auto-generated CLI reference from Cobra command tree and added richer context: status summary, in-progress, ready, blocked, and recent sections"}
{"id":"tl-e9a695f5","ts":"2026-01-17T02:09:52.415408Z","type":"delete"}
{"id":"a78e7e24","ts":"2026-01-17T20:28:18.939418Z","type":"create","title":"Explore file locking options for concurrent write safety","status":"open","priority":2,"description":"Investigate file locking approaches (syscall.Flock, lockfile, etc.) to prevent corruption when multiple agents write to the same JSONL file simultaneously. Determine if the risk is significant enough to warrant the added complexity, given tlog's minimalist philosophy."}
{"id":"a78e7e24","ts":"2026-01-17T20:57:43.712593Z","type":"update","notes":"Key questions to answer:\n1. How likely is the race? Two agents would need to write to the same daily file within milliseconds\n2. What's the blast radius? Corrupted line vs corrupted file vs data loss\n3. What's the simplest fix? flock() is ~10 lines but platform-specific; lockfile is portable but more code\n4. Is it worth it? Or just document 'don't run multiple tlog commands simultaneously'"}
{"id":"7335fe3f","ts":"2026-01-17T21:07:55.232745Z","type":"create","title":"Add --before option to delete command for bulk cleanup","status":"open","priority":3,"description":"Extend tlog delete to accept --before \u003cdate\u003e flag that bulk-deletes tasks completed before the given date. Helps manage log growth by removing old done tasks that are no longer relevant. Consider also adding --status filter (e.g., --status done) to prevent accidental deletion of open tasks."}
{"id":"a78e7e24","ts":"2026-01-17T21:09:36.726617Z","type":"status","status":"in_progress"}
{"id":"a78e7e24","ts":"2026-01-17T21:13:50.837116Z","type":"update","notes":"Research findings:\n\nRisk assessment:\n- Low probability: two agents need commands within ~1-10ms\n- Blast radius: corrupted JSON line(s), not total data loss\n- O_APPEND provides atomic seek, but write atomicity only for â‰¤PIPE_BUF (512b-4KB)\n- Typical events (200-500 bytes) are safe; large notes could exceed PIPE_BUF\n\nOptions considered:\n1. Do nothing + document limitation\n2. gofrs/flock library (~5 lines, cross-platform, battle-tested)\n3. DIY with golang.org/x/sys (~50 lines, no new dep)\n4. Lockfile approach (~30 lines, stale lock risk)\n\nRecommendation: Use gofrs/flock - minimal code, proven library, worth it for safety even if risk is low."}
{"id":"a78e7e24","ts":"2026-01-17T21:14:04.248597Z","type":"status","status":"done","resolution":"completed"}
{"id":"e41b6109","ts":"2026-01-17T21:14:06.337987Z","type":"create","title":"Add file locking using gofrs/flock","status":"open","priority":3,"description":"Add gofrs/flock dependency and wrap AppendEvent() with file locking to prevent corruption from concurrent writes. Lock on .tlog/tlog.lock file. Simple implementation: Lock() at start of AppendEvent, Unlock() via defer."}
{"id":"7335fe3f","ts":"2026-01-17T21:16:14.235192Z","type":"update","title":"Add cleanup command for time-based task retention","description":"Add 'tlog cleanup \u003cdays\u003e' command that deletes done tasks older than the specified number of days. Example: 'tlog cleanup 10' deletes all completed tasks older than 10 days. Only affects done tasks - open and in_progress tasks are preserved regardless of age. Simpler UX than date parsing."}
